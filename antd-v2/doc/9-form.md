# 添加甜点

欢迎来到新的一关《添加甜点》。这次又会用到表单的知识了，所以可以先再温习一下前面《提交表单》那一关的内容。

### 运行表单组件

进入《运行表单组件》这个任务。

添加三个字段的 Input

basic-form

分别是名称描述和价格，用到的 form 属性也好，还是 geFieldDecorator 也好，都是前面已经讲过的了，这里不啰嗦了。

看看达成的效果。随便写点什么，点提交按钮，终端中可以看到这些信息。

### 表单验证

进入《表单验证》这个任务。我们只验证用户是否填写了所有项目。

validate---

通过给每一个 getFieldDecorator 传递 config 参数，可以给每一个 input 添加验证规则，我们这里的验证规则比较简单，就是要求必填，当然这里也可以写的很复杂啦，可以看看官方文档上的各种写法。那规则填写好之后，何时被触发呢？答案就是在执行 validateFields 接口的时候，我把这个接口放到了 handleSubmit 中，如果验证不通过，就 return false 意思是什么都不要做，等待用户修复问题再次提交。

看看达成的效果。用户填写内容有缺失，点提交按钮，那么缺失项的 input 会有报错，提示用户填写内容。

### 添加 API

进入《添加 API》这个任务。

new-dish-api----

Postman 中测试一下接口

```
{
	"name": "新提拉",
	"desc": "新描述",
	"poster": "暂时没上传",
	"price": 12
}
```

返回信息中可以看到保存成功了。

看看达成的效果。

### 前端调用 API

进入《前端调用 API》这个任务。


submit-dish---

用户填写数据后点提交，会执行 submitDish Action 创建器，因为 poster 也就是海报数据暂时还没有涉及，所以这里先手动添加一个占位符，数据发送到服务器端，如果保存成功，就会返回这条 dish 的信息，我们把它发送给 reducer ，如果返回失败，就会打印出报错信息。

看看达成的效果。

### 上传海报

进入《上传海报》这个任务。


uploader---

上传海报任务其实是独立于 Form 的。Upload 组件一旦选择了文件，就自动开始上传，然后把服务器端返回的文件名传递给 handleSuccess 函数，我这里把这个文件名保存到了状态树的 dish.poster 字段。接下来到新建甜点的表单中，检查一下状态树中 dish.poster 的值，如果为空，就提示用户上传海报，否则，这个文件名会跟随添加其他数据一起被保存到服务器上这个甜点对应的记录中。

看看达成的效果。用户上传海报，然后填写所有信息，提交，可以看到成功提示。手动切换到已有甜点页面，刷新后可以看到新添加的甜点。

### 自动跳转

进入《自动跳转》这个任务。提交甜点成功后，自动跳转到已有甜点页面，并且能直接看到新甜点。

先实现跳转

redirect---

导入 histroy 对象用于页面跳转，导入 updateSeletedIndex 用于更新菜单项高亮。

然后，让新甜点自动出现在列表中

show-dish---

需要做的只是更新一下 redux 中的数据而已。

看看达成的效果。提交新甜点后，能直接跳转并看到新添加的甜点了。

看看达成的效果。

### 前台中查看甜点信息

后台提交新甜点后，就可以到《前台中查看甜点信息》。

启动我们在《 React 社交化电商--功能篇》中开发的电商系统。可以看管理员后台提交的任务都可以在前台的猜你喜欢页面上看到。

好了，《蚂蚁设计实战第二版》课程就到这里了，我是 Peter ，下一门课程中咱们再见。
