本节聊聊稍微深入点的内容。每个比特币的用户都知道地址和私钥的概念，看起来它们就是两串长长的字符串。我们自然而然就有了疑问，它们的原理是什么？到底安全吗？本文就来讨论这个问题，涉及到的核心知识点就是椭圆曲线算法。注意，Peter 的思路是这样，与其让初学者一下子就暴露到大量的数学推导面前迅速丧失兴趣，还不如让大家先在宏观上建立起理解，自己去决定要不要进行下一步更为细致的学习。

## 比特币中的使用场景

先来看看什么是椭圆曲线，以及比特币中是怎么使用它的。

**椭圆曲线密码学（Elliptic Curve Cryptography），简称ECC，是非对称加密的算法的一种。**

所谓非对称加密就是基于公钥和私钥的加密，双方通信的时候，可以让对方使用我的公钥去加密信息，我自己接收到密文之后用私钥来解密。或者我用私钥签署一份文件（即数字签名），这样所有持有我公钥的人都可以进行签名验证，从而来确认签署人的身份。但是加密通信也好，数字签名也好，都不是我们今天要关注的。我们主要关注公钥和私钥之间的运算关系，以及相关的安全性问题。具体来说，其实**比特币的地址就是进行了一定转换之后的公钥，而比特币私钥就是非对称加密中的私钥。**

公钥和私钥之间的运算就是通过椭圆曲线算法。看看网上的图，很有意思的就是，椭圆曲线算法涉及到的图形根本不是椭圆，而是一个类似乳头的形状，这是从计算椭圆弧长的公式中抽取了一部分而得到的曲线。

到这里，第一步我们就理解了。**椭圆曲线算法是用来生成非对称加密条件下的公钥和私钥的，而比特币系统正好就是用转换过的公钥去做地址，而用私钥做密码的。**

## 单向运算

接下来聊聊**比特币地址跟私钥之间的运算关系，简单来说四个字：单向运算。**

通常生成地址和私钥的过程是通过钱包软件自动完成的。所以一下子我们就拿到了地址和私钥，但其实底层是经历了下面几个先后步骤的。

**首先第一步是选私钥。比特币椭圆曲线算法下，私钥的要求是256位的二进制数。选私钥原则就是随机选**。软件帮我们生成时候，一般要求我们不断移动鼠标，造成系统上的一些随机行为，然后根据这些信息去找到一个随机数作为私钥。但实际上，我们自己随便选一个也是一样的，一路0101写下来，位数只要对，就是一个合法的私钥。但是首先一个疑问是，这样随机选会不会跟别人正好撞车呢？理论上可能，但是概率上基本趋近于0。2的256次方是个多大的数字呢？比可见宇宙中所有的原子数还有多。

**第二步需要根据私钥运算公钥**。私钥有了，我们知道公钥跟私钥肯定要成对存在。但是具体关系是什么呢？今天的主角椭圆曲线算法就要登场了。**把私钥交给算法，就能运算出它的公钥。同时根据公钥想反推私钥就完全不可能**。这就是所有的非对称加密算法的共性，ECC 当然也不会例外。这个过程的安全性，下一部分中我们会详细介绍。懂编程的同学可以自己动手进行运算，这样感觉就比较直观了。当然如果你使用的是钱包，软件就会帮我们在底层完成计算过程。

**接着来说第三步，私钥是256位太长了，所以钱包帮我们把它的格式变得简短些**，这就是我们最终看到的52个字符组成的字符串了。

**第四步，也是最后一步，把公钥转换成地址**，这个步骤多一些。具体都做了些什么我们不用太在意，反正最后没破坏它跟私钥之间的天然联系就是了。

好，步骤就是这些，重点是：**私钥可以算出公钥来，但 ECC 算法保证了根据公钥肯定算不出私钥来。**

## 安全吗？

当然最重要的问题就是安全了。非对称加密算法有很多种，例如最出名的还有一种叫 RSA ，但是 **ECC 被公认为在给定私钥长度下最安全的加密算法。**

**安全性的第一个保证就是运算要不可逆**。因为我的比特币地址，也就相当于公钥，是会公布出去的，要是有人能反向算出我的私钥，那安全性就荡然无存了。至于为何运算过程是不可逆的，这个基本上是数学家们要去保证的。好消息是，这些算法都是公开的，全球所有专家都盯着呢，我们普通人是可以放心的。

好，反向运算肯定不成了。但是就算 ECC 是完美的，毕竟私钥的位数是有限的，那我**用暴力穷举的方式能不能拿到呢？刚才提过了，理论上肯定是能的，但是概率很小**。其实椭圆曲线官方委员会多年来一直办挑战赛的，首先把私钥位数降低，也就是说把攻击难度降低了几十亿倍，这样让有钱的组织弄一个超级棒的计算机来算，但是事实证明，还是要很多年才能算出一个来。如果是实际上真正的256位，穷举破解要多强的算力呢？穷尽我们星球的资源估计也造不出这么多机器来。当然科技是会进步的，假如人类未来真的造成了超级棒的量子计算机，真的有人可以破解 ECC 了，那他首先想到的肯定不是攻击比特币，因为互联网上最重要的加密通信方式基本上都用 ECC ，如果你能破解，那么全世界的银行密码就都是你的了。

所以说，ECC 还是很安全的，被破解的概率比一天之内被雷劈中两次的概率还低。同时如果硬件技术都升级了，到时候 ECC 算法肯定也早就升级了。

## 总结

好，关于 ECC，也就是椭圆曲线算法，我们就聊到这里了。主要聊的是它在比特币中的使用场景，那就是根据私钥生成地址；然后介绍 ECC 的特点是可以用私钥运算出公钥，但是反之行不通；最后讨论了使用暴力去破解私钥的难度。所以对于普通人我觉得理解这些就足够了，没有必要去深入到 ECC 具体的公式推导过程中去。但是对于有志于开发区块链的程序员就不一样了，岗位面试的时候，ECC 和 Merkle Tree 等少数几个知识点一样，几乎是必考题。
