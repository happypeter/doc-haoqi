两个人在互联网上进行加密通信，需要双方共享一个相同的密钥，而互联网是一个不安全的环境，所以双方如何安全的共享密钥就成了大问题。Diffie–Hellman 密钥交换算法（后续简称 DH 算法）就是一套解决方案，可以让通信双方在不安全的通道内安全的共享密钥。DH 算法是 Whitfield Diffie 和 Martin Hellman 在1976年提出的，Merkle Tree 的发明人 Ralph Merkle 对 DH 算法的发明做出了重大贡献，也被认为是发明人之一，DH 算法的三位发明人，也同时被认为是公钥密码学的发明人，可见 DH 算法的地位。

## 单向函数

DH 算法是基于单向函数的，所以咱们先聊聊什么是单向函数。

所谓单向，指的是正向操作很容易，反向却很难。什么叫做单向呢？以混合颜色作类比，给出两种颜色，蓝色和黄色，正向操作是把两种颜色混到一起，这样可以得到的是绿色，这个很容易，任何人都可以做到。但是如果只知道混合后的颜色，很难去得到它是由那两种颜色混合而成的，也就是反向操作很难。

数学上的单向函数道理也类似。例如离散对数问题，正向很容易算出结果，但是根据输出结果反推输入就非常的难。具体 DH 算法中如何使用离散对数的，我们这里不展开。

单向函数好比一把锁，而 DH 算法就是基于这把锁来实现的。

## 操作步骤

下面来介绍一下整个交换过程的操作步骤，如果用真正的单向函数去讲解就会涉及到很多数学概念，比较不直观，所以我们还是用混色过程来讲解。

首先，通道是不安全的。Alice 和 Bob 想要共享一个颜色，但是他们之间的通信通道是互联网，是一个不安全的通道，也就意味着 Alice 和 Bob 互相传递的任何颜色，窃听者 Eve 都可以看到。那么在这个前提下，如何保证 Eve 不知道共享的颜色是什么呢？

具体过程是这样的。Alice 和 Bob 先共享一个公开色，例如黄色，使用互联网传递这个颜色就相当于公开了这个颜色，所以 Eve 也知道这个黄色。然后，Alice 和 Bob 各自选择了只有自己知道的一个机密色。机密色和公开色混合后，可以得到一个混合色，Alice 和 Bob 把各自得到的混合色互相交换一下，Eve 虽然可以拿到这两个混合色，但是也无法知道 Alice 和 Bob 的机密色分别是什么。下一步才是整个过程的核心，Alice 和 Bob 把自己的机密色和对方发过来的混合色再混一下得到一种新混合色。不知道你反应过来没有，两个人得到的混合色是一种颜色。这是因为 Alice 和 Bob 其实都是混合了相同的三种颜色，最终得到了混合色，只不过顺序有所差别。而 Eve 手里的各种颜色也不少，但是却无法混合出最终 Alice 和 Bob 手里的颜色。

最终，Alice 和 Bob 共享了一个颜色，可以作为一个安全的密钥来用，因为 Eve 是不知道这个颜色是什么的。

## 跟 RSA 的异同

可以这么说，公钥密码学的诞生，是以 DH 算法的发明为标志的。DH 算法出现后不久的1977年， RSA 算法就诞生了，RSA 是公钥密码学的代表性技术，那么 DH 算法跟 RSA 有什么异同呢。

有了 DH 算法，在一个不安全的环境下去进行加密通信就变得可能了。因为在上个世纪七十年代中期之前，加密通信采用的都是对称加密的方法。密钥需要事先通过某个安全的通道，例如双方代表见面，来进行共享。DH 算法出现以后，人们从此可以不必依赖安全通道，直接在不安全的网络上进行加密通信了。所以说，DH 算法虽然没有 RSA 算法的数字签名的功能，于是不能对通信双方进行认证，但是公钥密码学的基本框架已经有了。

DH 算法和 RSA 算法是有很多相似点的。首先，DH 算法和 RSA 都用到了公钥和私钥，安全的基石都是单向函数。其次，二者都可以用来在不安全通道下传递对称密钥。RSA 的加密算法其实也不适合用来加密大段信息，通常的使用方式也是在双方之间传递一下对称密钥，所以从这个角度讲，RSA 的加密功能，也可以认为是一种密钥交换的策略。

## 总结

这节主要内容就是这些。总之，DH 算法是一套让通信双方在不安全的通道中互换密钥的一种方案，从此人们在互联网上进行加密通信，就可以不需要事先用其他安全通道来互换密钥了。DH 算法的出现是当代密码学里程碑式的事件，是公钥密码学诞生的标志。

参考：

- https://www.youtube.com/watch?v=YEBfamv-_do
- https://en.wikipedia.org/wiki/Diffie–Hellman_key_exchange
- https://en.wikipedia.org/wiki/Public-key_cryptography
