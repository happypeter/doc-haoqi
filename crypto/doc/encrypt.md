每个人都有自己的一些小秘密，进行私密的沟通是人类自古以来的需求。古装片里面，动不动就会有入密室详谈这样的情节，密室保证的就是私密性。这节内容要聊的就是如何在网络上进行私密的沟通，或者说的正式点，就是来聊加密通信问题。早期解决方案跟密室是一个道理，就是通过私有网络，从物理上隔绝其他人。但是私有网络衰落，互联网兴起后，客观条件就不同了，互联网可以认为是一个大广场，数据，在通信过程中默认是能够被别人获取到的，那么这个时候保证私密的策略就从“不让你看见”变成“看见你也看不懂”了。具体做法就是：首先把信息加密成密文，到达接收方之后，再把密文解密成信息，这个过程就是加密通信。

## 对称加密和非对称加密

加密有两种不同的形式，一种是比较传统的对称加密，另外一种是互联网时代发明的非对称加密。

先说对称加密。这个是人类用了几千年的方式，凯撒密码就属于这种。所谓对称，意思就是发送方和接收方使用的是同一个钥匙。基本工作原理是非常简单的。发送方会通过一个密钥，把信息加密成密文，密文说白了就是谁也看不懂的东西。等密文到了接收方手里，接收者需要按照同样的密钥，把密文逆向转换成信息。加密通信过程就完成了。

但是对称加密的问题就在于如何事先安全的传递密钥本身。在互联网上，如果双方没有共享的密钥，就不能建立安全的通信通道，没有安全的通信通道，就无法安全的把密钥传递给接收方，所以这就是一个鸡生蛋蛋生鸡的问题了，需要想办法解决一下。传统的解决方法就是肉身见面，互通密钥后，再进行网络上加密通信，这个显然是成本很高的。于是，互联网上做加密通信就用到了非对称加密，解决了这个问题。非对称加密，也叫做公开密钥加密，特点是发送方和接收方使用的不是同一个密钥。

总之，加密通信可以采用的方式有两种，一种是对称加密，一种是非对称或者叫公开密钥加密。

## 公开密钥加密

下面来详细说说用公开密钥加密的基本原理。

首先，可以在自己的机器上安装密码学软件来生成公钥和私钥。注意，每次生成的时候，就会同时生成一对，一个是公钥，也就是 Public Key ，另外一个是私钥，也就是 Private Key 。公钥是可以公开的，分享给任何人的都没问题，私钥一定要保密。公钥和私钥之所以是一对，是因为二者有天然的数学联系，但是同时要保证给定公钥不能够算出私钥，不然就相当于加密方法被破解了。公钥和私钥的联系一般就是通过一些无解的数学问题来确定的，这类问题只能正向运算，不能反向运算，也就是说是单向函数。比如 8616460799 这个数是两个数相乘得到的，但是要从结果反推出这两个数，是基本不可能的。实际中 RSA 和 ECC 算法，都是基于某种单向函数。

好，有了公钥和私钥这一对儿有天然联系的密钥。那么加密通信过程是怎么样的呢？首先，如果 Bob 想让 Alice 给他发信息，注意这里 Alice 是发送方，而 Bob 是接收方。首先 Bob 要把自己的公钥传递给 Alice ，然后 Alice 用 Bob  的公钥去加密信息，Bob 收到密文之后可以用私钥进行解密。这就是非对称加密的基本逻辑了，公钥用于加密，私钥用于解密。这个过程好比就是 Bob 想安全的从 Alice 那里获得一些机密信息，所以 Bob 首先给 Alice 邮寄过去了一个带锁的箱子，注意这个箱子就相当于公钥，是用来加密的。Alice 把信息放到箱子里锁好，然后邮寄给 Bob ，这样 Bob 就可以用这把锁的钥匙，也就是私钥，去开启箱子了。

这就是非对称加密的基本过程了。

## 常见网络加密方式

网络上实际使用的各种软件通常都是通过对称加密和非对称加密配合来完成加密通信过程的。这是因为非对称加密虽然适合在互联网上使用，但是加密效率太低，不能进行大段数据的加密。所以实际中的做法是，通信双方会通过非对称加密的方式来传递对称加密的密钥，而用对称加密的方式来传输主体数据。我们来看几个实际例子。

先来看看常用于邮件加密的 PGP 的实际工作方式。PGP 是首个实现公钥密码学的大范围应用软件之一，它就使用了对称加密和非对称加密的混合密码系统架构。例如 Alice 要给 Bob 发送一段信息。具体通信流程是这样的。通信双方，Alice 和 Bob 分别在自己的机器上安装某种 PGP 客户端软件。Bob 先把自己的公钥发送给 Alice 。接下来 Alice 生成一个对称加密的密钥，用这个密钥把要发送的信息加密得到密文，并用 Bob 的公钥把这个对称密钥加密，然后把加密后的对称秘钥和密文这两个东西都发送给 Bob 。Bob 收到后可以用自己的私钥解密加密后的对称密钥，然后就可以用对称密钥解密密文得到 Alice 的信息了。

另外一种更为常见的加密通信场景是实现浏览器和服务器之间的加密通信，用到的是 HTTPS 协议，S 的意思是安全。HTTPS 也是对称加密和非对称加密混合使用的，基本道理跟 PGP 的思路一致，也是用非对称加密来传递对称加密的秘钥，而主体信息是用对称密钥来加密成密文的。但是这里我们稍微拓展一下，思考一下这个问题，服务器如果能安全的给浏览器发送公钥，这样，整个的通信过程也就基本安全了。但是问题是，如果公钥在传递过程中，被黑客替换了，通信过程的安全性就没有了。所以，当浏览器收到了公钥之后，如何才能确认这个公钥的确是要访问的服务器的公钥呢？实际上这个问题还真的是非常困难的，会涉及到证书和发证机构（ CA ）这样的概念。所以使用 HTTPS 过程中很大重要的一步就是安装证书。后面我们有专门的小节，详细介绍发证机构的工作原理，这里不展开了。

## 总结

好，来回顾一下本节的内容。要实现加密通信，有对称加密和非对称加密，也就是公开密钥加密两种方式。所谓非对称，就是加密和解密是采用不同的密钥。公钥用来加密信息，私钥用来解密信息。最后介绍了一些常见的加密通信方案，例如 PGP 和 HTTPS 都是如何借助混合加密架构来完成加密通信的。

参考：

- https://en.wikipedia.org/wiki/Public-key_cryptography
- https://www.binance.vision/zh/security/what-is-pgp
