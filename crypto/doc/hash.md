咱们作为非计算机专业的人去看一些区块链相关的技术资料的时候，经常会被一些讨厌的术语挡在门外。这次咱们聊的哈希就是非常重要的一个。哈希是密码学的基础，理解哈希是理解数字签名和加密通信等技术的必要前提。

## 基本含义

先来从基本定义入手。哈希，英文是 Hash ，本来意思是”切碎并搅拌“，有一种食物就叫 Hash ，就是把食材切碎并搅拌一下做成的。哈希函数的运算结果就是哈希值，通常简称为哈希。哈希函数有时候也翻译做散列函数。

根据维基百科的定义，哈希函数的作用是给一个任意长度的数据生成出一个固定长度的数据，作为它的映射。所谓映射就是一一对应。一个可靠的哈希算法要满足三点。第一是安全，给定数据 M 容易算出哈希值 X ，而给定 X 不能算出 M ，或者说哈希算法应该是一个单向算法。第二是独一无二，两个不同的数据，要拥有不相同的哈希，也就是刚刚说的让哈希和数据形成映射关系，一一对应。第三是长度固定，给定一种哈希算法，不管输入是多大的数据，输出长度都是固定的。但是仔细想一下，如果哈希的长度是固定的，也就是取值范围是有限的，而输入数据的取值范围是无限的，所以理论上总会找到两个不同的输入拥有相同的哈希。所以，哈希函数的安全性是个相对概念。如果出现了两个不同输入有相同输出的情况，就叫碰撞。不同的哈希算法，哈希位数越多，也就基本意味着安全级别越高，或者说它的”抗碰撞性“就越好。

再来说说哈希函数的主要作用。哈希的独一无二性，保证了如果数据在存储或者传输过程中有丝毫损坏，那么它的哈希就会变。哈希函数的主要作用就是进行完整性校验，完整的意思是数据无损坏。哈希有很多不同的称呼，有时候叫 digest 摘要，有时候叫 Checksum 校验值，有时候叫 fingerprint 指纹，两个人如果指纹一样，就证明是同一个人，同样的道理，如果两段数据的哈希完全一样，也可以证明这两段数据是完全一样的。

所以说，哈希函数的基本作用就是给任意长度的数据算出一个摘要性的长度固定的字符串，也就是所谓的哈希。哈希的作用主要是进行完整性校验。

## 哈希算法的分类

下一步我们把哈希函数分类，更细致的聊聊哈希算法的特点。首先说哈希算法有很多种，例如 md5 ，sha256 等等，但是它们总体上可以分为两大类，一类是普通哈希，主要用来做普通的完整性校验，检查数据有没有损坏。另外一类是加密哈希，也就是可以用在加密通信等安全级别要求比较高的场合的哈希。

目前还在使用的哈希算法是有很多种的。我们可以大致按照输出的哈希的长度来聊。例如 CRC-32 的输出是32位的二进制数，表示成十六进制就是8位。MD5 算法的哈希是128位二进制数，32位十六进制进制数，是比较常见的完整性校验哈希算法。SHA256 是256个二进制位，十六进制表示就是64位。这些算法可以分成普通哈希和加密哈希，两种算法之间没有特别明显的区别。例如本来 MD5 就是设计出来做加密哈希的，但是后来由于计算机运算速度提高了，MD5 出现碰撞的可能性就很大了，所以目前 MD5 只能当普通哈希用。加密哈希跟普通哈希的区别就是安全性，一般原则是只要一种哈希算法出现过碰撞，就会不被推荐成为加密哈希了。当然，如果对运算速度不敏感，加密哈希也能当普通哈希来用，Git 版本控制工具就是用 SHA1 这个加密哈希算法来做完整性校验的。一般来讲越安全的哈希算法，处理速度也就越慢，所以并不是所有的场合都适合用加密哈希来替代普通哈希。

目前最流行的加密算法是 SHA 系列。SHA 是 Secure Hash Aglorithm 也就是“安全哈希算法”的英文首字母。SHA 系列第一代只有一种算法叫 SHA-1 ，但是第二代 SHA-2 跟第一代不同，SHA-2 不是一种算法，而是一系列算法的统称，其中就包括咱们之前提过的 SHA-256 ，另外还包含 SHA-224、SHA-384、SHA-512 等等。目前认为 SHA-1 已经不足够安全了，不能作为加密哈希来使用。从2017年开始，SHA-1 算法生成的加密证书会被各大浏览器拒绝。SHA-2 ，尤其是 SHA-256 是目前非常流行的加密哈希算法。

SHA256 ，里面的256指的是哈希输出的位数，注意是二进制位数，通常表示成16进制，是64位。来生成一个试一下，到  https://tool.oschina.net/encrypt?type=2 输入 

```
I am peter!
```

点 `SHA256` 按钮，生成的结果是

```
1dc5138e551101775211dc427ecacc8f5f62a5245719c8fbb71e7af38858347d
```

可以看到的确是64位的十六进制数。

总之，哈希算法有很多种，长度越长的算法基本认为越安全。安全度低的哈希算法被认为是普通哈希算法，主要用来做完整性校验。安全度高的被称为加密哈希算法，会被用在加密安全领域。

## 实用例子

说了这么多基础知识，最后一部分咱们聊聊哈希在现实中几个应用场景。

首先一个场景是在注册一个网站的时候。当我们提交用户名密码，用户名被会直接保存到网站公司的数据库中，但是密码却不是直接保存的，而是先把密码转换成哈希，保存到数据库中的其实是密码的哈希。所以，即使是公司后台管理人员，也拿不到用户的密码。这样，如果万一公司数据库泄露了，用户的密码依然是安全的。而当用户自己登录网站的时候，输入密码提交到服务器，服务器上进行相同的哈希运算，因为输入数据没变，所以哈希也不会变，登录也就成功了。

当然最常见的的场景还是在完整性校验方面。例如，可以通过哈希确保区块链的区块数据没有被篡改。区块链为啥安全，就是因为新区块中保存了上一个区块的哈希。这样，形成一个链条，如果某个区块的数据被篡改了，那么哈希也就变了，也就意味着新区块就找不到它，相当于区块链断开了。

防篡改还有另外一种实用情景。比如我们一伙人合作做生意，有一个人维护了一个大账本，数据量很大。那么怎么保证这个管理账本的人不会篡改数据呢？那就是让这个人把这个账目生成一个哈希，然后把哈希登到报纸上，或者发布到论坛里，总之是让大家都看到。这样那个人一旦篡改了数据，那么肯定是会被发觉的，因为大家拿到新账目，运算一下哈希，就会发现跟之前发布的那个对不上了。

另外一个场景是区块链和加密货币中。比特币地址生成的时候，就用到了 SHA-256 算法，POW 也就是工作量证明，用的也是这个算法。

所以可以看到，哈希的应用场景是很广的。

## 总结

关于哈希和哈希函数，我们就聊到这里，下面来总结几句。哈希函数的作用是生成一个数据的哈希，或者叫摘要或者指纹，通常的使用场景就是完整性校验。哈希算法有很多种，一般来讲哈希越长的算法，安全性也就越高。安全度足够高的哈希，或者说没有任何人能够成功实现碰撞的哈希，才有资格被考虑用在加密场合，而这u77u类的哈希算法也被叫做加密哈希算法。实际中常见的哈希算法有 MD5 ，SHA-1 ，和 SHA-256 等等，其中 MD5 通常用来进行数据校验，SHA-1 曾经是加密哈希算法，但是目前已经被除名，也只能做为一种安全度更高的校验算法了。SHA-256 依然是广泛使用的加密哈希算法，在比特币生成地址以及 POW 工作量证明算法中都会用到。

参考：

- https://www.youtube.com/watch?v=xsp--srKWKw&list=PLSNNzog5eydvsPPMwn-6waomQXOOxZew4&index=2)
- https://en.wikipedia.org/wiki/Hash_function
- https://en.wikipedia.org/wiki/Cryptographic_hash_function
