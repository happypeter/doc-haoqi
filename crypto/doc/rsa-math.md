上个视频中，我们介绍完 RSA 算法的基本原理了，了解了 RSA 算法的加密锁就是先幂后模的运算。本节来看看如何生成公钥和私钥。

## 公钥和私钥

我们已经知道了，RSA 算法的加密过程就是

```
信息的 e 次方对 N 取模
```

取模就是求余数。得到的余数就是密文 c 了。e 和 N 组合起来就是公钥。解密过程是

```
密文的 d 次方对 N 取模
```

得到的结果是信息 m 。d 和 N 组合起来就是私钥。

显然，d ，e 和 N 之间要满足一定的数学关系，才能让上面加密和解密的两个函数同时成立。

## 生成公钥和私钥

要真正生成公钥和私钥，要做到的是，选择两个素数 p1 和 p2 ，让 p1*p2 = N 。所谓素数，就是只能被1和它自己整除的数。

我们会使用到欧拉函数。但是注意，在 RSA 这里，欧拉函数的本身的含义我们不用管，只需要记住结论

```
φ(N) = (p1-1)(p2-1)
```

比如

```
φ(77) = (7-1)*(11-1)
```

知道77可以分解成7和11，那么得到结果是60。而如果不知道 N 等分解成哪两个素数，那么 φ(N) 是算不出来的。

好，φ(N) 的值有了，那么 e 是一个自己随机选择的整数，但是要保证 e 大于1小于 φ(n) ，而且要于 φ(n) 互质，所以 e 显然不难选。这样，N 和 e 组合到一起，公钥就有了。

那么公钥有了，私钥怎么计算呢？

推导过程还是比较复杂的，还涉及到了欧拉定理，我们这里就从略了。最终可以得到

```
d = (k*φ(N) + 1)/e
```

d 就等于 k 乘以 φ(N) 加 1 再除以 e 。

可以看到只要知道 φ(N) ，d 就可以算出来了。而如果不知道 φ(N) ，有了 e 也根本算不出 d 来。上面的 k 没有预先的固定值，而是要在运算过程中拼凑出来的。要满足的条件是，k 的取值要保证 d 最终可以算出整数来。

这里可以看到，如果想要由 e 算出 d ，就要知道 φ(N) 的值，N 是公钥的一部分，是公开的。但是 φ(N) 是其他人没有办法直接算出来的。但是我们自己手里是有 p1 和 p2 的值的，对吧？所以 φ(N) 很容易得到，于是 d 也很容易算出来。这样 d 和 N 组合起来，私钥就有了。

从上面的过程也可以看出，RSA 算法的安全性取决于把 N 分解成两个素数的难度。只要大整数分解成两个素数还是是一个数学上无解的问题，RSA 算法就是安全的。

## 运算公钥和私钥

下面我们就来实际使用一下上面的结论，生成一下公钥和私钥。

首先选择两个比较大的素数，实际中会选择1024位二进制数，这是个非常大的数。但是我们这里为了演示方便，选择小的一点的。p1 = 53 , p2 = 59 ，这样 N = 53*59=3127。

先来生成公钥，我们选取 e = 3 。于是公钥就是 e 和 N 这两个数的组合。公钥有了。下一步来生成私钥，也就是去运算 d 。 因为知道 p1 和 p2 的值，所以 φ(N) 很容易算出结果，就是3016 。根据上面运算 d 的公式，当 k 等于 2 的时候，d 可以取得整数值，d 就等于

```
d = (2*3016+1)/3 = 2011
```

私钥就是 N 和 d 的组合。

这样我们就完成了生成公钥和私钥的过程。这样的一对密钥能不能顺利完成加密和解密呢？上个视频《 RSA 算法基本原理》中已经演示过了，是可以的。

## 总结

这节总体内容就是这些了。总结一下，RSA 算法的公钥是在一定范围内任意选取的，是 e 和 N 组合而成的。私钥 d 必须要由 e 运算出来，但是同时要保证，由 e 算出 d 的那个人是必须要知道 N 的整数分解的结果的。这样，基于大整数的分解是一个数学上无解的问题，外人是不能从 e 算出 d 的，所以 RSA 算法是安全的。

参考：

- https://www.youtube.com/watch?v=wXB-V_Keiu8
- https://www.kancloud.cn/kancloud/rsa_algorithm/48488
