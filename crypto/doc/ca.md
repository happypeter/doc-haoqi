本节聊的话题是数字证书。先来个预警，没有婚姻的社会里面，没有人能理解结婚证是干什么的，同理，不理解数字签名，也不会理解数字证书什么用。那么什么是数字证书，它能为数字签名提供怎么样的安全保证呢？咱们一起看看。

## 数字签名的问题

咱们先来看看数字签名过程中存在一个什么问题。

一个典型的数字签名的使用过程是这样的。Bob 想要发送一个附带数字签名的文件给 Alice 。第一步，Bob 生成自己的公钥和私钥。私钥他自己保管好，然后把公钥上传到一个公共服务器上，方便大家下载。接下来 Bob 创建了文件，里面写了一些他想对 Alice 说的话。然后，Bob 用私钥签署了这个文件，然后把文件和签名都发送给了 Alice 。Alice 收到文件之后，去公共服务器上下载了 Bob 的公钥，用它可以验证 Bob 的数字签名。如果验证成功，Alice 就可以相信这个信息的确是 Bob 发出的，并且传输过程中没有被篡改过。这就是数字签名的基本工作过程了。

但是，仔细推敲这个数字签名的验证过程，我们就会发现这个过程是有一个大的漏洞的。咱们再来梳理一下这个过程。Bob 首先生成了自己的公钥和私钥，把公钥上传到了一台公共服务器上。接下来，Bob 创建了文件，里面写了一些内容，并用私钥签署了这个文件。然后把文件和签名都发送给了 Alice 。那么安全漏洞就出来了。如果一个黑客截获了文件和签名，然后直接扔掉。然后黑客自己创建了文件，里面写了一些欺骗 Alice 的内容，用自己的私钥签署了这个文件，然后发送给了 Alice 。然后，把自己的公钥也上传到了一台公共服务器上。Alice 收到信息后，仍然认为是 Bob 发给她的。这时，如果 Alice 下载的公钥也是黑客的公钥，那么整个的验证过程也一样可以通过。Alice 此时根本无法判断发送信息的人到底是谁，黑客是可以假扮成 Bob 的。所以，我们看到数字签名的一大漏洞就是缺乏认证，单纯通过数字签名是不能验证出发信人身份的。

而数字证书就是为了解决这个漏洞而生。

## 什么是数字证书？

那究竟什么是数字证书呢？数字证书是一个由可信的第三方发出的，用来证明所有人身份以及所有人拥有某个公钥的电子文件。

我们还是回过头来看看刚才的那个例子。当 Bob 想要把公钥给 Alice 的时候，这次他不会把公钥上传到公共服务器上，让 Alice 去下载了。而是把公钥附带上一个数字证书发送给 Alice 。当然，同时发送给 Alice 的还有文件和数字签名。

那么一个数字证书中都包含哪些信息呢？首先会包含证书所有人的姓名，这里是 Bob 。第二，会写明所有人的公钥，以及公钥的有效期。第三项是发证机构的名字，所谓发证机构，就是有资格颁发证书的可信第三方，英文有个术语对应叫做 CA 。第四项是发证机构的数字签名。可能还会有一些其他内容，但是最重要的就是上面这四项。

Alice 收到证书后，会查看里面的各项内容。只要 Alice 信任这家发证机构，那么她就会信任这个证书上的内容。于是就会看到证书上的公钥的确是属于 Bob 的。这样就可以避免中间人攻击了。当然你可能会说，中间人能不能把证书也篡改了呢？答案是证书上不是还有第四项，也就是发证机构的数字签名。Alice 只需要去发证机构网站上拿到发证机构的公钥，验证一下这个签名，就知道数字证书是不是被篡改过了。

需要注意的是，数字证书是基于信任的。我们需要去信任发证机构。就像现实世界中，你相信我护照上的内容，是因为你相信发护照的机构。

## 总结

总结一下，数字证书是基于信任的，可以用来验证公钥所有人的身份。换句话说，它可以保证数字签名真的是我们认为的那个人签署的。

参考：

- https://www.youtube.com/watch?v=33VYnE7Bzpk
- https://www.youtube.com/watch?v=UbMlPIgzTxc&list=PLSNNzog5eyduzyJ8_6Je-tYOgMHvo344c
- https://en.wikipedia.org/wiki/Certificate_authority
