咱们说非对称加密，说公钥私钥，但是公钥和私钥到底是怎么产生的，加密和解密过程到底是怎么样的，不看看具体算法实现还真是感觉心里没底。RSA 算法是1977年发布的，是最早出现而且至今仍然是最为广泛使用的非对称密码学算法之一，所以咱们来聊聊 RSA 算法。会分两节来聊，本节瞄准宏观思路，看看加密解密的基本过程，后面一集聊底层数学原理，看看公钥和私钥之间的数学关系是怎样的。

## 宏观思路

学东西最怕的就是没有大思路，直接深入细节。所以开始之前，咱们先宏观上讨论一下 RSA 算法到底是用来干嘛的？总体的实现思路又是怎样的。

RSA 加密采用的是非对称加密的思路，咱们先来复习一下对称加密和非对称加密的区别。先说对称加密，Alice 要给 Bob 传递一个信息，首先 Alice 用一个密钥把信息加密成密文，例如 Alice 的信息是8，密钥是3，密文就是8-3=5，这样加密过程就结束了。于是密文5通过互联网传递给了 Bob。Bob 需要一个相同的密钥3来解密密文，也就是5+3=8，这样就得到了 Alice 要传递给他的信息了。实际中的密钥和加密解密方法比我们这里都要复杂的多，但是道理是一样的，加密和解密使用相同的密钥，所以这种加密方法被叫做对称加密。但是对称加密不适合直接在互联网上使用，因为 Alice 和 Bob 是没有办法去直接在互联网上安全的共享3这个密钥的。传统的做法是 Alice 和 Bob 肉身见面来共享这个密钥，这个成本太高了。RSA 是公钥密码学算法，背后的理念是”无秘密加密“（ non-secret encryption ），所以通信之前不需要双方沟通密钥。

什么是无秘密加密，我们可以用上锁和开锁来做一下类比。Alice 可以买一把锁，把钥匙自己保存好，然后把打开状态的锁发给 Bob 。Bob 就可以用这把锁把信息锁住，然后发送给 Alice 。注意这个过程中，传递的只是锁，钥匙根本就没有被传递过，而锁是不需要保密的。Alice 甚至可以把锁拷贝很多个，发送给很多人，这样每个人都可以给 Alice 安全的发信息了。Alice 手里面只要保存好钥匙即可。通过这个类比，可以看到无秘密加密的思路是可行的。

但是这个思路要想真正实用，还需要找到数学方法表示的钥匙跟锁。对应到 RSA 算法，就是首先要生成一对密钥，一个是公钥，或者叫加密密钥，另一个是私钥，或者叫解密密钥。宏观上，加密密钥会参与到加密过程中，给信息上锁。而解密过程是加密过程的逆过程，把锁打开获得信息，这个过程中需要用到解密密钥。

实现加密和解密的就是找到一个单向函数，函数的正向运算很容易，但是逆向运算很难。对应 RSA 的情况，也就是把公钥和信息作为参数传递进这个函数进行运算，得到密文，这个过程要很容易，而逆向运算，由密文和公钥想要反向获得信息，是很难做到的。当然，这个函数还必须有另外一个特点。就是逆向操作虽然默认很难做到的，但是如果拥有了特定的提示信息，操作就变得非常容易了。这里的提示信息，显然就是私钥。

## 具体实现

下面我们就来看看 RSA 算法具体的实现方式。

先来补充一个数学知识点：取模运算。取模运算其实就是算余数。

```
a mod n ≡ b。
```

mod 表示模，这里这个三个横线组成的等号叫做同余号，表示等式两侧余数相同。这个等式读作” a 与 b 对模 n 同余“，意思是a 与 b 分别用 n 去除，余数相同。

```
3 mod 2 ≡ 1
```

例如 a 是3，n 是2，那么 b 就等于1。同余号也是表示一种等价关系。因为1对2取余数，跟3对2取余数就是相等的，都是1，所以3和1，在对2取余数这个角度是等价的。

这样，我们就理解了取模运算的意思了。

RSA 使用的单向函数是这样的，拿出要加密的信息 m ，我们知道任何的计算机信息都能转换成二进制数，所以当然也能转换成十进制的一个整数。这里 m 是一个整数，根据 RSA 的算法规则，选择一个数字 e ，注意，RSA 的详细底层规则，咱们下一个视频中再解释。接下来，进行 m 的 e 次方运算，然后根据 RSA 算法规则选取整数 N 进行取模运算，最后得到的结果就是密文，用 c 表示。举个例子，m 等于7，e 选择为2，N 选择23，这样，最后的密文 c 就等于49对23取模，结果是3。也就是说7经过加密，最后密文是3。这个运算有个特点，给定 m 和 e 以及 N 的值，很容易算出 c ，但是给定 c 和 e 以及 N 很难算出 m 来。这就是我们需要的单向函数，或者说就是咱们要的数学形式的锁，也就是 ”e 次方然后对 N 取模“。而 e 和 N 的组合起来就是，加密密钥，或者叫公钥。

我们的锁就有了。那么，开这把锁的钥匙是什么呢？简单来说，就是让逆向运算过程变得简单的信息。

逆向运算，就是从密文得到信息。根据 RSA 的底层算法规则，在适当的选择了 e 和 N 的值的前提下，一定存在一个整数 d ，使得 c 的 d 次方对 N 取模，是可以得到 m 的。最终 d 和 N 组合到一起就是私钥也就是解密密钥。

总之，RSA 算法的单向函数找到了，于是加密用的锁也就找到了。但是其实这个函数本身不是 RSA 算法最复杂的地方，最复杂的内容在于如何适当的选择 e 和 N，又如何运算 d 出来的，这些内容下一节咱们再去介绍。

## 一个实际例子

下面我们来看一个实际的例子，实际用一下加密和解密的这两个公式。

Alice 首先要根据 RSA 的数学规则，合适的选择 e 和 N ，然后运算运算出 d 。这样 Alice 得到

```
e=3
N=3127
d = 2011
```

这样她把（e, N)组成了公钥，（d, N) 组成了私钥。

接下来 Alice 把公钥发送给 Bob 。这时，Bob 想要发送给 Alice 的信息是 m = 89 。Bob 这时就可以用加密用的那个函数对信息进行加密，具体做法就是

```
信息的 e 次方对 N 取模
```

带入具体数值就是，信息是89，e 取3，N 是3127。得到的结果是1394，所以密文 c 就是1394 。然后，Bob 把密文发送给 Alice 。Alice 于是可以用私钥来解密密文得到信息，具体做法就是前面提过的。

```
密文的 d 次方对 N 取模
```

带入密文1394以及私钥的具体数值就是

```
1394的2011次方对3127取模
```

这样 Alice 就可以得到信息 89 了。

加密解密过程完成。

## 总结

这就是 RSA 算法的工作原理了。宏观上的思路就是，要找到一个包含取模运算的单向函数，保证信息加密容易，而反向解密很难。但是如果有私钥，那么解密获得信息就很容易了。公钥和私钥生成的细节，我们没有展开，下个小节再给大家介绍。

参考：

- https://en.wikipedia.org/wiki/RSA_(cryptosystem)
- https://www.youtube.com/watch?v=wXB-V_Keiu8
- https://www.bilibili.com/video/av35557954/?spm_id_from=333.788.videocard.4
