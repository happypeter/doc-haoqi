# 构建请求 URL


分析个请求参数作用，构建请求链接。

### 实现功能

当客户点击购买按钮，确认订单之后，网站就会向支付宝网关发送请求，请支付宝提供担保交易服务， 支付宝核对请求，若审核通过，则给客户端展示一个支付宝担保交易界面，客户可以输入支付宝账号和密码， 接下来的事情就是客户和支付宝打交道了，网站只需耐心等待交易完成。

### 请求参数

打开支付宝纯担保交易接口文档，看一下数据交互部分，首先网站自己要构建数据，也就是请求参数 下面这张表格中列出了所有的请求参数。

参数分为不可空和可空两种，不可空参数不可遗漏

### 构建 url

若请求参数不经过签名，支付宝则不会处理发送过来的请求。那如何给参数签名：

所有的 参数名=值 键值对，除了 sign 和 sign_type 之外，按照字母顺序排序，然后把每个键值对用 & 字符连接起来，生成待签名字符串。

待签名字符串还要连接上支付宝给商户的私钥，这串字符串经过 MD5 算法运算的结果赋值给 sign 参数，然后把 sign 键值对添加到待签名字符串的后面，这就是要发送给支付宝的数据。

参数构建完成之后，把它们连接到支付宝网址字符串后面，构成一个新的带有查询字符串的网址，最终模样是这个样子的：

```
https://mapi.alipay.com/gateway.do?querystring
```

当然这么复杂的操作过程，不需要自己动手完成，alipay 这个 gem 的 create_partner_trade_by_buyer 方法 已经替我们完成了所有的工作，我们只要填写必要参数就可以了。