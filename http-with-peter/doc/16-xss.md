# 跨站脚本攻击 (XSS)

又是一个 Web 安全性问题，叫做跨站脚本攻击。其实我来聊这个话题并不是为了让咱们成为安全专家，
毕竟咱们这里还是面向新手的教程。但是即使对于新手，了解一下 XSS 的基本原理也是必要的。 Peter 觉得暂时咱们至少知道这个词，知道为何一些评论框中会禁用 html 标签，了解一些格式处理的库中为何有 html_safe 这样的接口。

### 啥是 XSS ？

做跨站脚本攻击，英文是 Cross-site scripting ，简称 **XSS** 。当咱们的网站上，允许用户输入的 HTML 和 javascript 在你自己的网站上直接显示的时候，就有可能遭受这种攻击。

啥意思呢？来看看实际情况就明白了，比如网站上有个评论框，然后恶意访客在里面输入了

```
Hello World <script>alert('Hello World')</script>
```

好，输入提交到服务器，回头用户再去访问这些内容的时候，我们想想，如果网站设计者允许这些内容不加处理的显示到浏览器中，那么 `alert()` 因为包裹在 script 标签内，所以肯定会执行的，这样用户打开网站，就会先看到一个警告框了。我们
网站的行为被篡改了，或者说网站已经被 XSS 了。


### 危险何在？

哈，显示个警告框的确没啥了不起，关了就是了。但是恶意攻击者可不会这么善良，因为可以去嵌入任意的 JS 代码，同时又
不受**同源策略**的限制（因为这些脚本就是在当前域名下执行的，对不？），恶意的 JS 代码可以做的事情可就多了去了。

恶意用户可以使用 HTML 和 javascript 代码对服务器或者以后访问这个页面的用户发起毁灭性的攻击。举个例子，一个攻击者可以使用 javascript 代码去获取所有在他之后访问这个页面的用户的会话 id ，然后伪装成这个用户。

#### 怎么破？


恐怕我们作为开发者，最关心的问题就是，这个问题在我们写网站的时候怎么避免？总结起来一句话

>总是对用户输入的内容做无害处理


有两个具体方法：

第一个就是，消除有问题的输入。比如```<script>```标签，或者使用一个更安全的输入格式，比如 Markdown，这样就可以阻止 HTML 和 javascript 同时出现在用户的输入里。

第二个办法就是在显示之前转义用户输入的所有数据.如果你需要用户能够输入 HTML 和 javascript 代码，那么当你显示这些输入内容的时候要确保它们被正确转义，这样浏览器就不会把它们当做代码给执行了。这种转义工作也有现成的接口可以使用，写代码的时候基本就是多套了函数的事儿，简单！
